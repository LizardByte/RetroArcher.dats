name: Daily build

on:
    push:
      branches:
        - master
    schedule:
        - cron:  '0 5 * * *'
    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
#        - name: Set workflow variables
#          id: step_one
#          run: |
#            echo "timestamp=$(date +%s)" >> $GITHUB_ENV

        - name: Checkout code
          uses: actions/checkout@v2

        - name: Setup Python
          uses: actions/setup-python@v2
          with:
            python-version: 3.9.6

        - name: Install python requirements
          run: |
            python -m pip install --upgrade pip
            pip install -r requirements.txt

        - name: Download dats and generate xmls (No-intro)
          id: generator_no_intro
          run: python no-intro.py

        - name: Download dats and generate xmls (Redump)
          id: generator_redump
          run: python redump.py

        - name: Testing
          run: |
            ls

#        - name: Create release
#          uses: softprops/action-gh-release@v1
#          with:
#            name: ${{ env.timestamp }}
#            tag_name: ${{ env.timestamp }}
#            files: |
#              no-intro(standard).xml
#              no-intro(standard).zip
#              no-intro(parent-clone).xml
#              no-intro(parent-clone).zip
#              redump.xml
#              redump.zip

        - name: Create release
          uses: svenstaro/upload-release-action@v2
          with:
            repo_token: ${{ secrets.GITHUB_TOKEN }}
            file: "*+(.xml|.zip)"
            tag: Nightly
            overwrite: true
            file_glob: true
